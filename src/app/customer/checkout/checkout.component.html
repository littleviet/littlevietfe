<div class="home" [ngClass]="{'noscroll': menuOpen}" #full>
  <!-- header -->
  <div class="header" #header>
    <div class="menu-title">
      <app-landing-title type="2" title="TAKE AWAY" color="#f3eacd"></app-landing-title>
    </div>
  </div>

  <app-cart-button></app-cart-button>
  <app-menu-button (isMenuOpen)="menuOpen = $event" [isDisplayBackground]="true"></app-menu-button>

  <div class="checkout-section" [style.height]="scrHeight > 0 ? scrHeight + 'px' : 'auto'">

    <!-- Back button -->
    <div class="back-button-section">
      <div onclick="window.history.back()" class="back-button">
        &lt;&lt; BACK
      </div>
    </div>

    <!-- Checkout response section -->
    <div *ngIf="orderSuccess != null" class="check-out-response">
      <router-outlet></router-outlet>
    </div>
    <!-- Register section -->
    <div *ngIf="(!loggedInAccountInfo || !loggedInAccountInfo.token) && orderSuccess == null"
      class="customer-register-section">
      <div class="customer-register-area">
        <!-- Login area -->
        <div class="login-area">
          <div class="login-area-title">Already registered?</div>
          <form class="login-form" [formGroup]="loginFormGroup" (submit)="onLoginSubmit()">
            <mat-form-field class="email-field" appearance="fill">
              <mat-label>Email address</mat-label>
              <input type="email" matInput [formControl]="emailFormControl" name="email" placeholder="Ex. pat@example.com">
              <mat-error *ngIf="emailFormControl.hasError('email') && !emailFormControl.hasError('required')">
                Please enter a valid email address
              </mat-error>
              <mat-error *ngIf="emailFormControl.hasError('required')">
                Email is <strong>required</strong>
              </mat-error>
            </mat-form-field>
            <mat-form-field class="password-field" appearance="fill">
              <mat-label>Password</mat-label>
              <input type="password" matInput [formControl]="passwordFormControl" placeholder="Ex. 123456">
              <mat-error *ngIf="passwordFormControl.hasError('required')">
                Password is <strong>required</strong>
              </mat-error>
            </mat-form-field>
            <div class="forgot-password">Forgot your password?</div>
            <button type="submit" [disabled]="loginFormGroup.invalid" class="login-btn"
              [ngClass]="{'login-btn-active': !loginFormGroup.invalid}">
              SIGN IN
            </button>
          </form>
        </div>

        <!-- Register area -->
        <div class="register-area">
          <div class="register-area-title">New customer?</div>
          <form class="register-form" [formGroup]="registerFormGroup">
            <!-- First name -->
            <mat-form-field class="email-field" appearance="fill">
              <mat-label>First name</mat-label>
              <input type="text" matInput formControlName="firstName" placeholder="Ex. Viet">
              <mat-error *ngIf="firstNameFormControl.hasError('required')">
                First name is <strong>required</strong>
              </mat-error>
            </mat-form-field>

            <!-- Last name -->
            <mat-form-field class="password-field" appearance="fill">
              <mat-label>Last name</mat-label>
              <input type="text" matInput formControlName="lastName" placeholder="Ex. Little">
              <mat-error *ngIf="lastNameFormControl.hasError('required')">
                Last name is <strong>required</strong>
              </mat-error>
            </mat-form-field>

            <!-- Telephone 1 -->
            <mat-form-field class="email-field" appearance="fill">
              <mat-label>Telephone</mat-label>
              <input type="text" matInput formControlName="phoneNumber1" appPhoneMask placeholder="Ex. 036 289 2891">
              <mat-error *ngIf="phone1FormControl.hasError('required')">
                Phone number is <strong>required</strong>
              </mat-error>
            </mat-form-field>

            <!-- Email -->
            <mat-form-field class="password-field" appearance="fill">
              <mat-label>Email address</mat-label>
              <input type="email" matInput formControlName="email" placeholder="Ex. pat@example.com">
              <mat-error *ngIf="emailFormControl.hasError('required')">
                Email is <strong>required</strong>
              </mat-error>
            </mat-form-field>

             <!-- Password -->
            <mat-form-field class="email-field" appearance="fill">
              <mat-label>Password</mat-label>
              <input [type]="hide ? 'password' : 'text'" matInput formControlName="password" placeholder="Ex. 123456">
              <button mat-icon-button matSuffix (click)="hide = !hide" [attr.aria-label]="'Hide password'" [attr.aria-pressed]="hide">
                <mat-icon>{{hide ? 'visibility_off' : 'visibility'}}</mat-icon>
              </button>
              <mat-error *ngIf="regPasswordFormControl.hasError('required')">
                Password is <strong>required</strong>
              </mat-error>
              <mat-error *ngIf="regPasswordFormControl.hasError('minlength')">
                Password <strong>must be at least 8 characters</strong>
              </mat-error>
            </mat-form-field>

            <!-- Confirm password -->
            <mat-form-field class="password-field" appearance="fill">
              <mat-label>Confirm password</mat-label>
              <input [type]="hide ? 'password' : 'text'" matInput formControlName="confirmPassword"
                placeholder="Ex. 123456" [errorStateMatcher]="matcher">
              <button mat-icon-button matSuffix (click)="hide = !hide" [attr.aria-label]="'Hide password'"
                [attr.aria-pressed]="hide">
                <mat-icon>{{hide ? 'visibility_off' : 'visibility'}}</mat-icon>
              </button>
              <mat-error *ngIf="registerFormGroup.hasError('notSame')">
                Passwords do <strong>NOT</strong> match
              </mat-error>  
            </mat-form-field>

            <div class="policy">PRIVACY POLICY*</div>

            <div class="policy-frame">
              <mat-checkbox required class="policy-checkbox" formControlName="policy">
                I agree to the terms and conditions and the privacy policy.
              </mat-checkbox>
            </div>

            <div class="news-frame">
              <mat-checkbox class="news-checkbox" formControlName="newsLetter">Sign up for our newsletter.</mat-checkbox>
            </div>
            
            <button [disabled]="registerFormGroup.invalid" class="register-btn"
              [ngClass]="{'register-btn-active': !registerFormGroup.invalid}"
              (click)="onRegisterSubmit()">
              REGISTER
            </button>
          </form>
        </div>
      </div>
    </div>

    <!-- Confirm payment -->
    <div *ngIf="loggedInAccountInfo && loggedInAccountInfo.token && orderSuccess == null" class="confirm-payment-section">
      <div class="confirm-order-area">
        <!-- Confirm order area -->
        <form class="order-detail-area" [formGroup]="submitPay" (submit)="onPaySubmit()">
          <div class="order-area-title">THE ORDER CAN BE COLLECTED</div>
          <div class="day-title">Today {{getDay()}}</div>
          <div class="position-title">en: Little Viet Barcelona</div>
          <div class="time-title">at:
            <select [formControl]="hourFormControl" required name="hour" class="picking-hour-confirm">
              <option *ngFor="let time of pickUpTimeValues" value="{{time}}">
                {{time.getHours()}}:{{time.getMinutes() == 0 ? '00': time.getMinutes()}}
              </option>
            </select>
          </div>
          <div class="payment-method-title">Payment method:
            <mat-checkbox required formControlName="paymentMethod" name="paymentMethod"
              class="payment-method-checkbox">
              Credit card
            </mat-checkbox>
          </div>
          <textarea formControlName="additionalRequest" class="additional-info-field" placeholder="Additional information"></textarea>
          <button [disabled]="submitPay.invalid || (isCartEmptyObs | async)"
            [ngClass]="!submitPay.invalid && !(isCartEmptyObs | async) ? 'pay-btn-active': 'pay-btn-inactive'" class="pay-btn">
            PAY
          </button>
        </form>
      </div>
    </div>

    <!-- Order detail -->
    <div class="cart-detail">
      <app-cart-detail titleBtn="ORDER MORE"></app-cart-detail>
    </div>
  </div>

  <!-- Footer -->
  <div #footerPlaceHolder [style.height]="footerHeight > 0 ? footerHeight + 'px' : 'auto'" class="footer-place-holder"></div>
  <div #footer class="footer-area">
    <app-footer [isDisplayLogo]="false"></app-footer>
  </div>
</div>

<app-progress-spinner *ngIf="(authActionsObs | async)!.length > 0 || (takeAwayActionsObs | async)!.length > 0"></app-progress-spinner>

